services:
  discord-bot:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: discord-anythingllm-bridge
    environment:
      - NODE_ENV=production
      - ANYTHINGLLM_URL=http://anythingllm:3009
    env_file:
      - .env
    restart: unless-stopped
    networks:
      - gibbs-apps
    volumes:
      - ./logs:/usr/src/app/logs:rw
    labels:
      - "app=discord-anythingllm-bridge"
      - "environment=production"
    depends_on:
      - anythingllm

  anythingllm:
    image: mintplexlabs/anythingllm:latest
    container_name: anythingllm
    ports:
      - "3009:3001"  # Map host 3009 to container 3001
    environment:
      - STORAGE_DIR=/app/storage
      - SERVER_PORT=3001
    volumes:
      - anythingllm-storage:/app/storage
    restart: unless-stopped
    networks:
      - gibbs-apps
    labels:
      - "app=anythingllm"
      - "environment=production"

volumes:
  anythingllm-storage:
    driver: local

networks:
  gibbs-apps:
    external: true
